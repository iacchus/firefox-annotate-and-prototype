!function(){function a(a,b){a.className.indexOf(b)>=0||(a.className=a.className+" "+b)}function b(a,b){a.className=a.className.replace(new RegExp("\\b"+b+"\\b","g"),"")}function c(){d();var a=t.naturalWidth,b=t.naturalHeight;v.width=a,v.height=b,L.drawImage(t,0,0)}function d(){M=[],N=0,O=null,P=null,Q=!1,u=new Image,b(v,"crop"),a(B,"hide"),a(C,"hide"),b(A,"hide"),v.removeEventListener("mousedown",i),v.removeEventListener("touchstart",i),v.removeEventListener("mousemove",k),v.removeEventListener("touchmove",k),v.removeEventListener("mouseup",l),v.removeEventListener("touchend",l)}function e(){L.clearRect(0,0,v.width,v.height),L.drawImage(w,0,0)}function f(){w.width=v.width,w.height=v.height,w.getContext("2d").drawImage(v,0,0)}function g(a,b){var c=v.getBoundingClientRect();return{x:Math.round(a)-c.left*(v.width/c.width),y:Math.round(b)-c.top*(v.height/c.height)}}function h(){a(v,"crop"),b(B,"hide"),a(A,"hide"),M=[],N=0,M.push(v.toDataURL()),u.src=t.src,f(),j(),v.addEventListener("mousedown",i),v.addEventListener("touchstart",i),v.addEventListener("mousemove",k),v.addEventListener("touchmove",k),v.addEventListener("mouseup",l),v.addEventListener("touchend",l),o()}function i(b){b.preventDefault(),a(C,"hide"),e(),O=g("undefined"==typeof b.clientX?b.touches[0].clientX:b.clientX,"undefined"==typeof b.clientY?b.touches[0].clientY:b.clientY),Q=!0,j()}function j(){L.save(),L.globalAlpha=.5,L.fillStyle="black",L.fillRect(0,0,v.width,v.height),L.restore()}function k(a){a.preventDefault();var b=g("undefined"==typeof a.clientX?a.touches[0].clientX:a.clientX,"undefined"==typeof a.clientY?a.touches[0].clientY:a.clientY);if(Q){var c=Math.min(O.x,b.x),d=Math.max(O.x,b.x),f=Math.min(O.y,b.y),h=Math.max(O.y,b.y);e(),j(),L.save(),L.beginPath(),L.rect(c,f,d-c,h-f),L.clip(),L.drawImage(u,0,0),L.restore()}}function l(a){a.preventDefault();var c="undefined"==typeof a.clientX?a.changedTouches[0].clientX:a.clientX,d="undefined"==typeof a.clientY?a.changedTouches[0].clientY:a.clientY;P=g(c,d),Q=!1,C.style.top=d+"px",C.style.left=c+"px",b(C,"hide")}function m(){var b=Math.min(O.x,P.x),c=Math.max(O.x,P.x),d=Math.min(O.y,P.y),e=Math.max(O.y,P.y);a(C,"hide");var g=new Image;g.src=v.toDataURL(),g.onload=function(){L.clearRect(0,0,v.width,v.height),v.width=c-b,v.height=e-d,L.drawImage(g,b,d,c-b,e-d,0,0,c-b,e-d),f(),M.push(v.toDataURL()),N=M.length-1,u.src=M[N],o()}}function n(){a(C,"hide"),e()}function o(){M.length&&0!==N?b(D,"disabled"):a(D,"disabled"),M.length&&N!==M.length-1?b(E,"disabled"):a(E,"disabled")}function p(){if(M.length&&0!==N){var a=M[--N],b=new Image;b.src=a,u.src=a,b.onload=function(){L.clearRect(0,0,v.width,v.height),v.width=b.naturalWidth,v.height=b.naturalHeight,L.drawImage(b,0,0),f()},o()}}function q(){if(M.length&&N!==M.length-1){var a=M[++N],b=new Image;b.src=a,u.src=a,b.onload=function(){L.clearRect(0,0,v.width,v.height),v.width=b.naturalWidth,v.height=b.naturalHeight,L.drawImage(b,0,0),f()},o()}}function r(){t.src===M[N]?c():t.src=M[N]}var s="undefined"!=typeof chrome?chrome:"undefined"!=typeof browser?browser:void 0,t=new Image,u=new Image,v=document.getElementById("target"),w=document.createElement("canvas"),x=document.getElementById("download"),y=document.getElementById("print"),z=document.getElementById("crop"),A=document.getElementById("controls"),B=document.getElementById("cropControls"),C=document.getElementById("confirmControls"),D=document.getElementById("crop-back"),E=document.getElementById("crop-forward"),F=document.getElementById("crop-stop"),G=document.getElementById("confirm-crop"),H=document.getElementById("cancel-crop"),I=document.getElementById("instruction"),J=document.getElementById("boxclose"),K=document.getElementById("copyToClipboard"),L=v.getContext("2d"),M=[],N=0,O=null,P=null,Q=!1;!function(){t.addEventListener("load",c,!1),s.runtime.onMessage.addListener(function(a,b,c){"update_url"===a.method&&(t.src=a.url,c({success:!0}))}),x.addEventListener("click",function(){var a=document.createElement("a");a.download="screenshot.jpg",a.href=t.src,document.body.appendChild(a),a.click(),document.body.removeChild(a)}),y.addEventListener("click",function(){window.print()}),K.addEventListener("click",function(){a(I,"visible")}),J.addEventListener("click",function(){b(I,"visible")}),z.addEventListener("click",h),G.addEventListener("click",m),H.addEventListener("click",n),D.addEventListener("click",p),E.addEventListener("click",q),F.addEventListener("click",r)}()}();